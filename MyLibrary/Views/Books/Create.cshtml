@model MyLibrary.Models.Book

@{
    ViewData["Title"] = "Create";
    var idaa = ViewBag.chosenShelf ?? -1; // במקרה שלא נבחר מדף, נגדיר ערך ברירת מחדל של -1
    var shelves = ViewBag.Shelves as List<Shelf>;
    var formType = ViewBag.FormType as bool? ?? false;
}

<html>
<head>
    <style>
        #ListShelf tbody tr {
            cursor: pointer;
        }

            #ListShelf tbody tr:hover {
                background-color: #f1f1f1;
            }

        #ListShelf th {
            text-align: center;

    </style>
    <style>
        #ListShelf {
            border-collapse: collapse; /* למנוע כפילות גבולות */
            width: 100%; /* אם תרצה שהטבלה תתפוס את כל רוחב הדף */
        }

            #ListShelf th, #ListShelf td {
                border: 1px solid black; /* גבול בין התאים */
                padding: 8px; /* ריווח פנימי */
                text-align: center; /* מרכז את הכותרות ואת התוכן */
            }
    </style>
    <meta charset="utf-8">
    <title>הוסף ספר</title>
    <script type="text/javascript">
        let shelfIdi = @idaa;  // הכנסת הערך מ-ViewBag.chosenShelf למשתנה גלובלי ב-JavaScript

        window.onload = function () {
            const warningMessage = document.getElementById("warningMessage");
            if (warningMessage) {
                confirmAddBook();
            }
            // הצג את טבלת המדפים אם יש מדפים
            if (@(formType.ToString().ToLower())) {
                document.getElementById('ListShelf').style.display = 'block';
            }
        };

        function confirmAddBook() {
            const userConfirmed = confirm("האם אתה בטוח שאתה רוצה להוסיף את הספר?");
            if (userConfirmed) {
                document.getElementById("isConfirmed").value = 3;
                document.getElementById("choiceShelf").value = shelfIdi;
                document.getElementById("addBookForm").submit();
            } else {
                alert("הוספת הספר בוטלה.");
            }
        }

        function selectShelf(shelfId) {
            shelfIdi = shelfId;
            console.log(shelfIdi);
            document.getElementById("isConfirmed").value = 2;
            document.getElementById("choiceShelf").value = shelfIdi;
            document.getElementById("addBookForm").submit();
        }
    </script>
</head>
<body>
    <h1>הוסף ספר</h1>

    @if (!string.IsNullOrEmpty(ViewBag.WarningMessage))
    {
        <div id="warningMessage">@ViewBag.WarningMessage</div>
    }

    <hr />
    <div class="row">
        <div class="col-md-4">
            <form id="addBookForm" asp-action="Create">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <div class="form-group">
                    <label asp-for="Name" class="control-label"></label>
                    <input asp-for="Name" class="form-control" />
                    <span asp-validation-for="Name" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Category" class="control-label"></label>
                    <input asp-for="Category" class="form-control" />
                    <span asp-validation-for="Category" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Height" class="control-label"></label>
                    <input asp-for="Height" class="form-control" />
                    <span asp-validation-for="Height" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Width" class="control-label"></label>
                    <input asp-for="Width" class="form-control" />
                    <span asp-validation-for="Width" class="text-danger"></span>
                </div>
                <input type="hidden" id="isConfirmed" name="IsConfirmed" value="1" />
                <input type="hidden" id="choiceShelf" name="ChoiceShelf" value="1" />
                <div class="form-group">
                    <input type="submit" value="צור" class="btn btn-primary mr-2" />
                    <a asp-action="Index" class="btn btn-secondary">חזרה לרשימה</a>
                </div>
            </form>
        </div>
    </div>


    @if (shelves != null && shelves.Count > 0)
    {
        <table id="ListShelf">
            <thead>
                <tr>
                    <th>גובה</th>
                    <th>רוחב</th>
                    <th>מצב</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var shelf in shelves)
                {
                    <tr onclick="selectShelf(@shelf.Id)">
                        <td>@shelf.Height</td>
                        <td>@shelf.rest</td>
                        <td>@shelf.Mode</td>
                    </tr>
                }
            </tbody>
        </table>
    }

    @section Scripts {
        @{
            await Html.RenderPartialAsync("_ValidationScriptsPartial");
        }
    }
</body>
</html>
